var SentiLSM=function(){return{D:{},dict:{},astDict:{},moodAstDict:{},initialize:function(){this.dict=this.D.dictionary;this.astDict=this.D.astDict;this.moodAstDict={};this.extractPartialDictionary()},loadDictionary:function(e){this.D=e},extractPartialDictionary:function(){for(key in this.astDict){var e=this.astDict[key];for(var t=0;t<e.length;t++){var n=e[t];if(n=="126"||n=="127"||n=="465"||n=="466"){this.moodAstDict[key]=e;break}}}},getWordCount:function(e){var t=0;for(var n=0;n<e.length;n++){var r=this.processline(e[n]);var i=r.split(/\s+/);if(i.length>0&&i[0].length!=0){t+=i.length}}return t},processword:function(e){var t=false;var e=e.toLowerCase();var n=e.length-1;if(e[n]=="."|e[n]==","|e[n]=="?"){t=false}e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\,\.\:\<\>]/g,"");e=e.replace("\\u00a0","");e=e.trim();return e},processline:function(e){debug.debug(e);content=e;content=content.replace("~","");content=content.replace("#","");content=content.replace("@","");content=content.replace("!","");content=content.replace("-","");content=content.replace("\\u00a0","");content=content.trim();return content},lsm:function(e,t){score=1-Math.abs(e-t)/(e+t+1e-4);return score},getLSM:function(e,t,n,r){if(t==0){t+=.001}if(r==0){r+=.001}averageLSM=(this.lsm(e[3]/t,n[3]/r)+this.lsm(e[9]/t,n[9]/r)+this.lsm(e[10]/t,n[10]/r)+this.lsm(e[12]/t,n[12]/r)+this.lsm(e[16]/t,n[16]/r)+this.lsm(e[17]/t,n[17]/r)+this.lsm(e[18]/t,n[18]/r)+this.lsm(e[19]/t,n[19]/r)+this.lsm(e[20]/t,n[20]/r))/9;return averageLSM},partialMatch:function(e){var t=false;for(key in this.moodAstDict){var n=RegExp("\\b"+key);t=n.test(e);if(t){return key}}return""},getmoodmap:function(e){var t={};var n,r,i,s,o,u,a,f;var l={};var c;var h={};h["3"]=0;h["9"]=0;h["10"]=0;h["12"]=0;h["16"]=0;h["17"]=0;h["18"]=0;h["19"]=0;h["20"]=0;l["126"]=0;l["127"]=0;l["465"]=0;l["466"]=0;l["501"]=0;n=0;i=0;r=0;s=0;for(var p=0;p<e.length;p++){c=this.processline(e[p]);words=c.split(/\s+/);for(var d=0;d<words.length;d++){var v=words[d];v=v.trim();var m=this.processword(words[d]);if(this.dict.hasOwnProperty(m)||this.dict.hasOwnProperty(v)){if(!this.dict.hasOwnProperty(m)){m=v;l["501"]+=1}}else{m=this.partialMatch(m)}if(m!=""){var g=this.dict[m];o=false;u=false;a=false;f=false;if(!g){debug.debug(m)}for(var y=0;y<g.length;y++){var b=g[y];l[b]+=1;h[b]+=1;if(b=="19"){negate=true}if(b=="126"){o=true}if(b=="127"){u=true}if(b=="465"){a=true}if(b=="466"){f=true}}if(o){if(a){n+=1}else if(f){i+=1}var w=true;for(var E=0;E<posWords.length;E++){if(m==posWords[E]){w=false;break}}if(w){posWords.push(m)}}else if(u){if(a){r+=1}else if(f){s+=1}var w=true;for(var E=0;E<negWords.length;E++){if(m==negWords[E]){w=false;break}}if(w){negWords.push(m)}}}}}t={moodmap:{highneg:r,highpos:n,lowneg:s,lowpos:i},lsmcount:h,emoticoncount:l["501"]};return t},getCats:function(e){var t=[];var n=e;e=this.processword(e);if(this.dict.hasOwnProperty(e)||this.dict.hasOwnProperty(n)){if(!this.dict.hasOwnProperty(e)){e=n}}else{e=this.partialMatch(e)}if(e!=""){var r=this.dict[e];for(var i=0;i<r.length;i++){var s=r[i];if(t[s]){t[s]+=1}else{t[s]=1}}}return t},countLSMWords:function(e){var t={};t["3"]=0;t["9"]=0;t["10"]=0;t["12"]=0;t["16"]=0;t["17"]=0;t["18"]=0;t["19"]=0;t["20"]=0;for(var n=0;n<e.length;n++){content=this.processline(e[n]);words=content.split(/\s+/);for(var r=0;r<words.length;r++){var i=words[r];var s=this.processword(words[r]);if(this.dict.hasOwnProperty(s)||this.dict.hasOwnProperty(i)){if(!this.dict.hasOwnProperty(s)){s=i}}else{s=this.partialMatch(s)}if(s!=""){var o=this.dict[s];for(var u=0;u<o.length;u++){var a=o[u];t[a]+=1}}}}return t},isAllCaps:function(e){if(/[a-z]/i.test(e)&&e.toUpperCase()==e)return true;else return false},getAllCapsCount:function(e){var t=0;for(var n=0;n<e.length;n++){words=e[n].split(/\s+/);for(var r=0;r<words.length;r++){if(this.isAllCaps(words[r])){t+=1}}}return t},getWordCountMatch:function(e,t){return this.lsm(e,t)},getVerbalucce:function(e,t,n){return(e+t+n)/3},getMoodMatchScore:function(e,t){var n=this.lsm(e["126"],t["126"])+this.lsm(e["127"],t["127"])/4;return n},RunVerbalucce:function(e,t){var n={};var r=0;var i=this.countLSMWords(e);var s=this.getWordCount(e);var o=this.countLSMWords(t);var u=this.getWordCount(t);var a=this.getLSM(i,s,o,u);var f=this.getWordCountMatch(s,u);var l=this.getmoodmap(e);var c=this.getmoodmap(t);var h=this.getAllCapsCount(e);var p=this.getAllCapsCount(t);var d=(this.lsm(l.moodmap.highpos,c.moodmap.highpos)+this.lsm(l.moodmap.lowpos,c.moodmap.lowpos)+this.lsm(l.moodmap.highneg,c.moodmap.highneg)+this.lsm(l.moodmap.lowneg,c.moodmap.lowneg))/4;var v=this.lsm(l.emoticoncount,c.emoticoncount);var m=this.lsm(h,p);if(s>50&&u>50){r=(a+f+d+m+v)/5}else{a=0;r=(f+d+m+v)/4}a=a.toFixed(2);v=v.toFixed(2);m=m.toFixed(2);d=d.toFixed(2);r=r.toFixed(2);n={verbalucce_score:r,moodmatch_score:d,allcapsmatch_score:m,emoticonmatch_score:v,lsmscore:a,moodmap1:l.moodmap,moodmap2:c.moodmap,wc1:s,wc2:u};return n}}}